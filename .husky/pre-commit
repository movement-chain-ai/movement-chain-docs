echo "ğŸš€ Running pre-commit checks..."
echo ""

# Run lint-staged to check only changed markdown files
echo "ğŸ“ Linting staged markdown files..."
npx lint-staged

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Markdown linting failed!"
  echo "   Fix the issues above before committing."
  echo ""
  exit 1
fi

echo ""
echo "ğŸ” Checking for TODO/FIXME comments in staged files..."

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(md|py|js|ts|yaml|yml)$' || true)

if [ -n "$STAGED_FILES" ]; then
  # Check for TODO/FIXME in staged files
  TODO_COUNT=$(echo "$STAGED_FILES" | xargs grep -n -E "(TODO|FIXME)" 2>/dev/null | wc -l | tr -d ' ')

  if [ "$TODO_COUNT" -gt 0 ]; then
    echo "âš ï¸  Found $TODO_COUNT TODO/FIXME comment(s) in staged files:"
    echo "$STAGED_FILES" | xargs grep -n --color=always -E "(TODO|FIXME)" 2>/dev/null || true
    echo ""
    echo "ğŸ’¡ Consider resolving these before committing (warning only, not blocking)"
  fi
fi

echo ""
echo "âœ… Pre-commit checks passed!"
echo "â±ï¸  This was fast because we only checked changed files"
