# 工程术语表

> 嵌入式系统、传感器工程、信号处理相关术语

---

## 术语索引

| # | 术语 | 英文 | 简要说明 |
|---|------|------|----------|
| 1 | [IMU](#1-imu-惯性测量单元) | Inertial Measurement Unit | 惯性测量单元，包含加速度计和陀螺仪 |
| 1.1 | [加速度计](#11-加速度计-accelerometer) | Accelerometer | 测量比力的传感器，静止时读数包含重力 |
| 1.2 | [陀螺仪](#12-陀螺仪-gyroscope) | Gyroscope | 测量角速度的传感器，静止时读数为零 |
| 2 | [EMG](#2-emg-肌电传感器) | Electromyography | 肌电传感器，测量肌肉电活动 |
| 3 | [采样率](#3-采样率-sampling-rate) | Sampling Rate | 传感器每秒采集数据的次数，单位 Hz |
| 4 | [fps](#4-fps-每秒帧数) | Frames Per Second | 视频/图像每秒采集的帧数 |
| 5 | [漂移](#5-漂移-drift) | Drift | 传感器随时间累积的测量误差 |
| 6 | [边缘 AI](#6-边缘-ai-edge-ai) | Edge AI | 在设备端直接运行 AI 推理 |
| 7 | [I2C / SPI](#7-i2c--spi-通信协议) | Communication Protocols | 芯片间的通信协议 |
| 8 | [MCU](#8-mcu-微控制器) | Microcontroller Unit | 微控制器，嵌入式系统的"大脑" |
| 9 | [PCB](#9-pcb-印刷电路板) | Printed Circuit Board | 印刷电路板，电子元件的物理载体 |
| 10 | [KiCad](#10-kicad) | KiCad | 开源 EDA 软件，用于 PCB 设计 |
| 11 | [BLE 抖动](#11-ble-抖动-ble-jitter) | BLE Jitter | 蓝牙低功耗传输的时间不确定性，15-30ms |

---

## 1. IMU (惯性测量单元) {#1-imu-惯性测量单元}

**定义：** IMU (Inertial Measurement Unit) 是一种传感器模块，用于测量物体的运动状态。

---

### 组成

| 传感器 | 测量内容 | 单位 | 轴数 |
|--------|----------|------|------|
| **加速度计** | 线性加速度（往哪个方向移动、多快） | g 或 m/s² | 3 轴 (X, Y, Z) |
| **陀螺仪** | 角速度（转动的快慢） | °/s 或 rad/s | 3 轴 (X, Y, Z) |

### 常见 IMU 规格

| 规格 | 说明 |
|------|------|
| **6 轴 IMU** | 3 轴加速度计 + 3 轴陀螺仪 |
| **9 轴 IMU** | 6 轴 + 3 轴磁力计（指南针） |

### Movement Chain AI 选用

我们选用 **STMicroelectronics LSM6DSV16X**（6 轴 IMU）：

| 参数 | 规格 |
|------|------|
| 加速度计量程 | ±2/±4/±8/±16g |
| 陀螺仪量程 | ±125 ~ ±2000 dps |
| 最大采样率 | 7680 Hz |
| 推荐采样率 | 100-200 Hz（运动分析） |
| 工作电流 | 0.55mA @ 104Hz |
| 特色功能 | 内置 MLC（机器学习核心） |

> 详见：[ADR-0002 LSM6DSV16X IMU 选型](../design/decisions/0002-lsm6dsv16x-imu.md)

---

### 1.1 加速度计 (Accelerometer) {#11-加速度计-accelerometer}

**定义：** 加速度计是 IMU 的核心组件之一，用于测量物体的线性加速度。但其实际测量的是**比力 (Specific Force)**，而非真实加速度。

---

#### 工作原理

加速度计本质上是一个**力传感器**，内部结构基于 MEMS（微机电系统）技术：

```text
加速度计内部结构 (MEMS):

┌───────────────────────────────────────┐
│                                       │
│    固定框架                            │
│    ┌─────────────────────────────┐    │
│    │                             │    │
│    │    ════╦════  ← 弹簧        │    │
│    │        ║                    │    │
│    │      ┌───┐                  │    │
│    │      │ ● │ ← 质量块 (proof mass) │
│    │      └───┘                  │    │
│    │        ║                    │    │
│    │    ════╩════  ← 弹簧        │    │
│    │                             │    │
│    └─────────────────────────────┘    │
│                                       │
│    电容板检测质量块位移 → 输出电压      │
│                                       │
└───────────────────────────────────────┘
```

当传感器受力时，内部质量块相对于框架产生位移，电容变化被转换为电压信号输出。

---

#### 比力 vs 真实加速度

加速度计测量的是**比力**，即单位质量受到的非引力的力：

| 物理量 | 公式 | 说明 |
|--------|------|------|
| **比力** | `f = a - g` | 加速度计实际测量的 |
| **真实加速度** | `a = f + g` | 需要补偿重力才能得到 |

**为什么静止时有读数？**

```text
传感器静止放在桌上时：

  实际运动状态：静止（真实加速度 = 0）
  加速度计显示：accel_y ≈ 9.8 m/s²

  原因：
  ┌─────────────────────────────────────┐
  │                                     │
  │   内部质量块被重力下压               │
  │   弹簧产生支撑力                     │
  │   传感器检测到这个"支撑力"           │
  │   输出 +9.8 m/s²                    │
  │                                     │
  └─────────────────────────────────────┘
```

#### 不同状态下的读数

| 状态 | 真实加速度 | 加速度计读数 | 说明 |
|------|-----------|-------------|------|
| **静止放桌上** | 0 | **9.8 m/s²** | 检测到重力 |
| **自由落体** | 9.8 m/s² | **0** | 失重状态 |
| **向上加速** | +a | 9.8 + a | 重力 + 运动加速度 |
| **向下加速** | -a | 9.8 - a | 重力 - 运动加速度 |

---

#### 获取真实加速度的方法

| 方法 | 公式/说明 | 适用场景 |
|------|----------|----------|
| **直接减去重力** | `accel_real = accel_raw - g` | 传感器固定朝向（如水平放置） |
| **高通滤波** | 滤除低频分量（含重力） | 动态运动，朝向不断变化 |
| **传感器融合** | 用陀螺仪估算姿态，动态补偿重力 | 精确应用 |
| **硬件输出** | LSM6DSV16X SFLP 直接输出线性加速度 | ✅ **推荐** |

---

#### 在 Movement Chain AI 中的应用

```text
高尔夫挥杆场景：
┌─────────────────────────────────────────────────────┐
│                                                     │
│  我们主要用 gyro (角速度)，较少依赖 accel：          │
│                                                     │
│  ✅ gyro_z: 检测挥杆速度峰值 (850°/s+)              │
│  ✅ gyro: 零交叉检测划分挥杆阶段                    │
│                                                     │
│  ⚠️ accel: 辅助检测冲击力 (Impact 瞬间)             │
│     → 此时用原始值即可，不需要精确的"真实加速度"    │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**LSM6DSV16X 的优势**：

该传感器内置 **SFLP (Sensor Fusion Low Power)** 功能，可以直接输出去除重力后的线性加速度：

```cpp
// LSM6DSV16X 输出选项
lsm6dsv16x_linear_acceleration_get(&dev_ctx, &linear_accel);  // 去重力后
lsm6dsv16x_acceleration_raw_get(&dev_ctx, &raw_accel);        // 含重力原始值
```

> 详见：[数据处理与指标计算 §3.2](../design/architecture/data-processing/metrics-calculation.md#32-imu-数据处理-lsm6dsv16x--1666hz) — IMU 数据处理

---

### 1.2 陀螺仪 (Gyroscope) {#12-陀螺仪-gyroscope}

**定义：** 陀螺仪是 IMU 的核心组件之一，用于测量物体的**角速度**（旋转速度），单位为 °/s（度每秒）或 rad/s（弧度每秒）。

---

#### 工作原理

MEMS 陀螺仪基于**科里奥利力 (Coriolis Force)** 原理工作：

```text
MEMS 陀螺仪内部结构:

┌─────────────────────────────────────────────────┐
│                                                 │
│   ┌─────────┐        ┌─────────┐               │
│   │  ← → ← → │ ← 振动质量块（持续往复振动）      │
│   └─────────┘                                   │
│        ↓                                        │
│   当传感器旋转时                                 │
│        ↓                                        │
│   ┌─────────┐                                   │
│   │    ↕    │ ← 科里奥利力使质量块侧向偏移       │
│   └─────────┘                                   │
│        ↓                                        │
│   电容板检测偏移量 → 输出角速度                  │
│                                                 │
└─────────────────────────────────────────────────┘

公式：F_coriolis = 2m × v × ω
     m = 质量块质量
     v = 振动速度
     ω = 旋转角速度（我们要测的！）
```

**核心原理**：质量块持续振动，当整个传感器旋转时，科里奥利力使质量块产生垂直于振动方向的偏移，偏移量与角速度成正比。

---

#### 陀螺仪 vs 加速度计

| 特性 | 陀螺仪 | 加速度计 |
|------|--------|----------|
| **测量内容** | 角速度（转动快慢） | 比力（移动快慢 + 重力） |
| **单位** | °/s 或 rad/s | m/s² 或 g |
| **静止时读数** | **0** ✅ | **9.8 m/s²**（重力） |
| **重力干扰** | **无** ✅ | 有（需补偿） |
| **积分得到** | 角度（姿态） | 速度/位置 |
| **主要问题** | 漂移（积分误差累积） | 重力混叠 |

---

#### 为什么陀螺仪是运动分析的主力？

| 优势 | 说明 |
|------|------|
| **无重力干扰** | 不管姿态如何变化，静止时始终输出 0 |
| **直接测旋转** | 挥杆本质是旋转运动，陀螺仪天然适配 |
| **响应快** | 瞬时角速度变化立即反映在输出中 |
| **信号干净** | 不需要像加速度计那样做重力补偿 |

---

#### 在 Movement Chain AI 中的应用

```text
高尔夫挥杆分析：
┌─────────────────────────────────────────────────────┐
│                                                     │
│  🎯 gyro_z (绕 Z 轴角速度) 是核心指标：              │
│                                                     │
│  ┌────────────────────────────────────────┐        │
│  │ 挥杆速度峰值检测                        │        │
│  │ → gyro_z 峰值可达 850°/s 以上           │        │
│  │ → 专业球手可达 1000°/s+                 │        │
│  └────────────────────────────────────────┘        │
│                                                     │
│  ┌────────────────────────────────────────┐        │
│  │ 挥杆阶段划分（零交叉检测）               │        │
│  │ → gyro_z 从正变负：挥杆方向反转          │        │
│  │ → 用于划分 Backswing / Downswing        │        │
│  └────────────────────────────────────────┘        │
│                                                     │
│  ┌────────────────────────────────────────┐        │
│  │ 节奏分析                                │        │
│  │ → Backswing 时间 / Downswing 时间       │        │
│  │ → 理想比例约 3:1                        │        │
│  └────────────────────────────────────────┘        │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### gyro vs accel 使用场景对比

| 场景 | 推荐传感器 | 原因 |
|------|-----------|------|
| **挥杆速度** | gyro_z ✅ | 直接测量旋转速度 |
| **阶段划分** | gyro ✅ | 零交叉检测清晰 |
| **节奏分析** | gyro ✅ | 角速度曲线平滑 |
| **Impact 检测** | accel ⚠️ | 击球冲击力明显 |
| **姿态估算** | 两者融合 | 互相补偿各自缺陷 |

---

#### LSM6DSV16X 陀螺仪规格

| 参数 | 规格 |
|------|------|
| 量程选项 | ±125 / ±250 / ±500 / ±1000 / ±2000 dps |
| 推荐量程 | ±2000 dps（高尔夫挥杆需要） |
| 噪声密度 | 3.8 mdps/√Hz |
| 零偏稳定性 | ±1 dps |
| 最大采样率 | 7680 Hz |

```cpp
// LSM6DSV16X 陀螺仪配置示例
lsm6dsv16x_gy_full_scale_set(&dev_ctx, LSM6DSV16X_2000dps);  // 量程 ±2000°/s
lsm6dsv16x_gy_data_rate_set(&dev_ctx, LSM6DSV16X_GY_ODR_1666Hz); // 采样率 1666Hz

// 读取角速度
int16_t raw_gyro[3];
lsm6dsv16x_angular_rate_raw_get(&dev_ctx, raw_gyro);
float gyro_z_dps = raw_gyro[2] * sensitivity;  // 转换为 °/s
```

> 详见：[数据处理与指标计算 §3.2](../design/architecture/data-processing/metrics-calculation.md#32-imu-数据处理-lsm6dsv16x--1666hz) — IMU 数据处理

---

## 2. EMG (肌电传感器) {#2-emg-肌电传感器}

**定义：** EMG (Electromyography，肌电图) 是一种测量肌肉电活动的传感器技术，用于分析肌肉激活模式。

---

### 工作原理

肌肉收缩时，神经信号触发肌纤维产生**电位变化**（约 0.1-5 mV），EMG 传感器检测并放大这些微弱的电信号。

```text
神经信号 → 肌纤维激活 → 电位变化 → EMG 电极检测 → 信号放大 → 数字化
```

### EMG 信号特性

| 特性 | 数值 |
|------|------|
| 信号幅度 | 0.1 - 5 mV |
| 频率范围 | 20 - 500 Hz |
| 推荐采样率 | 1000 - 2000 Hz |
| 典型信噪比 | 需要滤波处理 |

### 电极类型

| 类型 | 特点 | 适用场景 |
|------|------|----------|
| **湿电极** | 导电凝胶，信号质量最佳 | 医疗级、实验室 |
| **干电极** | 无凝胶，可重复使用 | 消费级可穿戴 |
| **针电极** | 插入肌肉，最精确 | 临床诊断（侵入式） |

Movement Chain AI 选用**干电极**，平衡信号质量与用户体验。

### 在高尔夫中的应用

EMG 是我们的**核心差异化**——市场上 0 家竞品有此功能。

| 应用场景 | EMG 提供的洞察 |
|----------|---------------|
| **肌肉代偿检测** | 核心弱 → 手臂代偿 |
| **发力时序分析** | 髋 → 核心 → 肩 → 臂 顺序 |
| **疲劳预警** | 在受伤前提醒休息 |
| **左右不平衡** | 识别弱侧肌群 |

```text
场景: 用户挥杆"感觉不对"

❌ 无 EMG:  视觉显示"转肩不足" → 用户不知道为什么
✅ 有 EMG:  检测到"核心激活弱 → 肩部代偿" → 给出针对性训练
```

### Movement Chain AI EMG 配置

| 参数 | 规格 |
|------|------|
| EMG 通道数 | 2 通道（左右前臂） |
| 模拟前端芯片 | ADS1292 |
| 采样率 | 1000 Hz |
| 电极类型 | 可重复使用干电极 |

> 详见：[EMG 硬件](../components/emg/hardware.md)

---

## 3. 采样率 (Sampling Rate) {#3-采样率-sampling-rate}

**定义：** 采样率是指传感器每秒采集数据的次数，单位为赫兹 (Hz)。

---

### 公式

$$
f_s = \frac{n}{\Delta t}
$$

| 符号 | 含义 | 单位 |
|------|------|------|
| f_s | 采样率 | Hz |
| n | 采样次数 | 次 |
| Δt | 时间间隔 | s |

### 常见采样率

| 采样率 | 每次采样间隔 | 说明 |
|--------|-------------|------|
| 30 Hz | 33.3 ms | 普通视频帧率 |
| 60 Hz | 16.7 ms | 高帧率视频 |
| 100 Hz | 10 ms | 基础运动捕捉 |
| 500 Hz | 2 ms | IMU 标准采样 |
| 1000 Hz | 1 ms | 高精度 IMU / EMG |

### 奈奎斯特定理

采样率必须**至少是信号最高频率的 2 倍**，才能准确重建信号：

$$
f_s \geq 2 \times f_{max}
$$

### 在高尔夫中的应用

高尔夫下杆仅约 **250ms**，需要高采样率才能捕捉细节：

| 传感器类型 | 典型采样率 | 适用场景 |
|-----------|-----------|----------|
| **Vision (视觉)** | 30-60 Hz | 姿态估计，慢动作分析 |
| **IMU (惯性)** | 500-1000+ Hz | 挥杆速度、加速度、角度 |
| **EMG (肌电)** | 1000+ Hz | 肌肉激活时序分析 |

#### 为什么 EMG 需要高采样率？

肌电信号的频率范围约 **20-500 Hz**，根据奈奎斯特定理：

$$
f_s \geq 2 \times 500 = 1000 \text{ Hz}
$$

因此 EMG 采样率通常为 **1000-2000 Hz**。

#### 采样率 vs 精度

| 采样率 | 下杆期间采样点数 | 能捕捉的细节 |
|--------|-----------------|-------------|
| 30 Hz | ~8 点 | ❌ 太少，丢失关键瞬间 |
| 100 Hz | ~25 点 | ⚠️ 基础分析 |
| 500 Hz | ~125 点 | ✅ 详细运动轨迹 |
| 1000 Hz | ~250 点 | ✅✅ 肌肉激活时序 |

---

## 4. fps (每秒帧数) {#4-fps-每秒帧数}

**定义：** fps (Frames Per Second，每秒帧数) 是视频或图像采集频率的单位，表示每秒钟采集或显示多少帧图像。

---

### fps 与 Hz 的关系

fps 和 Hz 本质上是同一概念在不同领域的表达：

| 术语 | 全称 | 使用领域 | 含义 |
|------|------|----------|------|
| **fps** | Frames Per Second | 视频/图像 | 每秒帧数 |
| **Hz** | Hertz | 通用信号/传感器 | 每秒周期数 |

**换算**：1 fps = 1 Hz（但习惯上视频用 fps，传感器用 Hz）

### 常见 fps 规格

| fps | 每帧间隔 | 典型应用 |
|-----|----------|----------|
| 24 fps | 41.7 ms | 电影标准 |
| 30 fps | 33.3 ms | iPhone 默认摄像、电视 |
| 60 fps | 16.7 ms | 高帧率视频、游戏 |
| 120 fps | 8.3 ms | 慢动作回放 |
| 240 fps | 4.2 ms | 高速摄影 |

### Movement Chain AI 中的应用

| 数据源 | 采集频率 | 单位习惯 | 说明 |
|--------|----------|----------|------|
| **MediaPipe Vision** | 30 | fps | iPhone 摄像头默认帧率 |
| **IMU** | 1666 | Hz | 惯性传感器采样率 |
| **EMG** | 1000 | Hz | 肌电传感器采样率 |

### 为什么 Vision 用 30fps？

| 考量 | 说明 |
|------|------|
| **iPhone 默认** | 大多数 iPhone 摄像头默认 30fps |
| **够用** | 完整挥杆 1-1.5 秒 = 30-45 帧，足以分析姿态 |
| **计算负担** | 更高帧率需要更多 GPU/CPU 资源 |
| **存储成本** | 60fps 文件大小翻倍 |

### fps 与时间分辨率

fps 决定了能分辨的**最短时间间隔**：

| fps | 时间分辨率 | 能捕捉 |
|-----|-----------|--------|
| 30 fps | 33.3 ms | 姿态变化、关节角度 |
| 60 fps | 16.7 ms | 更细腻的动作过渡 |
| 240 fps | 4.2 ms | 击球瞬间细节 |

!!! info "为什么 IMU 用 Hz 而不是 fps？"
    fps 专指**图像帧**，而 IMU 输出的是**数值数据**（加速度、角速度），所以用 Hz 表示采样率更准确。

> 详见：[数据流 §2.1](../design/architecture/data-processing/data-pipeline.md#21-d1-d2-信号采集与数字化) — MediaPipe Vision 30fps 数据采集

---

## 5. 漂移 (Drift) {#5-漂移-drift}

**定义：** 漂移是指传感器的测量值随时间逐渐偏离真实值的现象，是 IMU 的固有问题。

---

### 漂移的来源

| 来源 | 说明 |
|------|------|
| **陀螺仪偏置** | 静止时输出不为零，误差随时间累积 |
| **温度变化** | 温度影响传感器精度 |
| **噪声积分** | 对角速度积分求角度时，噪声也被积分 |

### 漂移的影响

```text
开始时：传感器认为"正前方"是 0°
10分钟后：传感器认为"正前方"是 2°（实际没变）
30分钟后：传感器认为"正前方"是 6°（误差越来越大）
```

### 不同 IMU 的漂移性能

| IMU | 稳定窗口 | 评价 |
|-----|----------|------|
| MPU6050 | 10-15 分钟 | ❌ 过时技术 |
| BNO055 | 15-20 分钟 | ⚠️ 已停产 |
| ICM-42688-P | 25-30 分钟 | ⚠️ 中档 |
| **LSM6DSV16X** | **45+ 分钟** | ✅ 专业级 |

### 漂移补偿方法

| 方法 | 说明 |
|------|------|
| **传感器融合** | 结合加速度计、磁力计校正陀螺仪 |
| **卡尔曼滤波** | 用数学算法估计和修正误差 |
| **定期校准** | 用户手动重置参考方向 |
| **视觉辅助** | 用摄像头数据校正 IMU 漂移 |

---

## 6. 边缘 AI (Edge AI) {#6-边缘-ai-edge-ai}

**定义：** 边缘 AI 是指在终端设备（如传感器、手机）上直接运行 AI 推理，而不依赖云端服务器。

---

### 传统方式 vs 边缘 AI

| 方式 | 流程 | 延迟 | 功耗 | 隐私 |
|------|------|------|------|------|
| **云端 AI** | 设备 → 云服务器 → AI 处理 → 返回结果 | 高 | 高 | 差 |
| **边缘 AI** | 设备内部 AI 处理 → 直接输出结果 | 低 | 低 | 好 |

### LSM6DSV16X 的 MLC（机器学习核心）

LSM6DSV16X 内置 MLC，可以在芯片内部直接进行运动分类：

| 能力 | 说明 |
|------|------|
| 算法类型 | 决策树分类器 |
| 程序内存 | 256 字节/树，最多 8 棵树 |
| 分类延迟 | <1ms |
| 功耗优势 | 比连续 MCU 处理减少 90% |
| 用例 | 运动识别、跌倒检测、手势分类 |

### 边缘 AI 的优势

| 优势 | 说明 |
|------|------|
| **低延迟** | 实时反馈，无需等待网络 |
| **低功耗** | 不需要不停发送数据 |
| **隐私保护** | 原始数据不离开设备 |
| **离线可用** | 无需网络连接 |

---

## 7. I2C / SPI (通信协议) {#7-i2c--spi-通信协议}

**定义：** I2C 和 SPI 是两种常用的芯片间串行通信协议，用于 MCU 与传感器之间的数据传输。

---

### I2C (Inter-Integrated Circuit)

| 特性 | 说明 |
|------|------|
| **线数** | 2 线（SDA 数据 + SCL 时钟） |
| **速度** | 标准 100kHz，快速 400kHz，高速 1MHz |
| **拓扑** | 总线型，可挂多个设备 |
| **优势** | 接线简单，节省引脚 |
| **劣势** | 速度较慢 |

### SPI (Serial Peripheral Interface)

| 特性 | 说明 |
|------|------|
| **线数** | 4 线（MOSI, MISO, SCK, CS） |
| **速度** | 可达 10MHz+ |
| **拓扑** | 主从型，每个从设备需独立 CS |
| **优势** | 速度快，全双工 |
| **劣势** | 引脚多 |

### 选择建议

| 场景 | 推荐协议 | 原因 |
|------|----------|------|
| 原型开发 | I2C | 接线简单，调试方便 |
| 生产产品 | SPI | 高速传输，适合 100Hz+ 采样 |
| 多传感器 | I2C | 总线共享，节省引脚 |
| 高速采样 | SPI | 带宽足够 |

### Movement Chain AI 配置

| 阶段 | 协议 | 配置 |
|------|------|------|
| MVP 原型 | I2C | 400kHz，简化接线 |
| 生产版本 | SPI | 8MHz，配合 DMA |

---

## 8. MCU (微控制器) {#8-mcu-微控制器}

**定义：** MCU (Microcontroller Unit) 是嵌入式系统的核心处理器，集成了 CPU、内存、外设接口于一体。

---

### MCU vs CPU

| 特性 | MCU | CPU (电脑处理器) |
|------|-----|------------------|
| 集成度 | 高（CPU + RAM + Flash + 外设） | 低（需外部芯片） |
| 功耗 | 极低（mA 级） | 高（W 级） |
| 性能 | 适中 | 极高 |
| 成本 | 低（$1-10） | 高（$100+） |
| 用途 | 嵌入式设备、IoT | 电脑、服务器 |

### Movement Chain AI 选用

我们选用 **ESP32-S3**：

| 参数 | 规格 |
|------|------|
| CPU | 双核 Xtensa LX7 @ 240MHz |
| RAM | 512KB SRAM + 8MB PSRAM |
| Flash | 16MB |
| 无线 | WiFi + Bluetooth 5 (BLE) |
| 特色 | AI 加速器，支持 TensorFlow Lite |
| 成本 | ~$4/片 |

> 详见：[ADR-0005 ESP32-S3 微控制器选型](../design/decisions/0005-esp32-s3-microcontroller.md)

### 为什么选 ESP32-S3？

| 对比项 | ESP32-C3 | ESP32-S3 | 结论 |
|--------|----------|----------|------|
| CPU 核心 | 单核 RISC-V | 双核 Xtensa | S3 更强 |
| AI 加速 | 无 | 有向量指令 | S3 适合 ML |
| BLE | BLE 5.0 | BLE 5.0 | 相同 |
| 成本 | $2.5 | $4 | C3 更便宜 |
| **选择** | 简单应用 | **ML + 多传感器** | ✅ S3 |

---

## 9. PCB (印刷电路板) {#9-pcb-印刷电路板}

**定义：** PCB (Printed Circuit Board，印刷电路板) 是电子设备的物理基础，用于机械支撑和电气连接电子元件。

---

### 什么是 PCB？

PCB 是一块由绝缘材料制成的板子，表面覆盖铜箔，通过蚀刻形成导电线路，用于连接各种电子元件。

```text
软件 vs 硬件 类比：
────────────────────────────────────
代码文件 (.py, .dart)  ←→  PCB 设计文件 (.kicad_pcb)
VS Code 编辑器         ←→  KiCad 设计软件
编译运行               ←→  发给工厂生产
软件应用               ←→  实体电路板
```

### PCB 的层级

| 类型 | 层数 | 成本 | 适用场景 |
|------|------|------|----------|
| **单层板** | 1 层 | 最低 | 简单电路（玩具、遥控器） |
| **双层板** | 2 层 | 低 | 大多数消费电子 |
| **四层板** | 4 层 | 中等 | 复杂数字电路、高速信号 |
| **多层板** | 6-12+ 层 | 高 | 高密度设计（手机、电脑主板） |

### Movement Chain AI PCB 设计

我们的传感器模块需要一块自定义 PCB：

```text
┌─────────────────────────────────────┐
│          Movement Chain PCB          │
│  ┌───────────┐  ┌───────────────┐   │
│  │ ESP32-S3  │──│  LSM6DSV16X   │   │  ← MCU 连接 IMU
│  │   (MCU)   │  │    (IMU)      │   │
│  └───────────┘  └───────────────┘   │
│        │        ┌───────────────┐   │
│        └────────│   ADS1292     │   │  ← MCU 连接 EMG
│                 │    (EMG)      │   │
│                 └───────────────┘   │
│     [电池]  [BLE天线]  [USB充电]     │
└─────────────────────────────────────┘
```

### PCB 设计流程

| 步骤 | 输出文件 | 说明 |
|------|----------|------|
| 1. 原理图设计 | .sch | 定义元件及电气连接 |
| 2. PCB 布局 | .kicad_pcb | 物理位置和走线 |
| 3. 设计规则检查 (DRC) | - | 验证无短路、间距合规 |
| 4. 生成制造文件 | Gerber + BOM | 发给 PCB 工厂 |
| 5. 焊接装配 | - | SMT 贴片或手工焊接 |

### 常见 PCB 术语

| 术语 | 英文 | 说明 |
|------|------|------|
| **走线** | Trace | PCB 上的铜导线 |
| **过孔** | Via | 连接不同层的孔 |
| **焊盘** | Pad | 元件焊接点 |
| **丝印** | Silkscreen | PCB 上的文字/标记 |
| **阻焊层** | Solder Mask | 绿色/蓝色保护层 |
| **BOM** | Bill of Materials | 元件清单 |
| **Gerber** | Gerber Files | 标准制造文件格式 |

---

## 10. KiCad {#10-kicad}

**定义：** KiCad 是一款开源的 EDA (Electronic Design Automation) 软件，用于设计 PCB 原理图和布局。

---

### 基本信息

| 项目 | 内容 |
|------|------|
| **类型** | 开源 EDA 软件 |
| **许可证** | GPL v3（免费） |
| **支持平台** | Windows / macOS / Linux |
| **官网** | [kicad.org](https://www.kicad.org) |
| **当前版本** | KiCad 8.x (2024-2025) |

### KiCad 的核心功能

| 功能模块 | 作用 |
|----------|------|
| **Eeschema** | 原理图编辑器 |
| **PCBnew** | PCB 布局编辑器 |
| **3D Viewer** | 3D 预览 PCB 成品效果 |
| **Gerber Viewer** | 查看制造文件 |
| **符号/封装库** | 内置海量元件库 |

### KiCad vs 其他 EDA 工具

| 工具 | 类型 | 价格 | 特点 |
|------|------|------|------|
| **KiCad** | 开源 | 免费 | 功能完整，社区活跃 ✅ |
| Altium Designer | 商业 | ~$7000/年 | 专业级，企业首选 |
| Eagle (Fusion 360) | 商业 | ~$500/年 | Autodesk 生态 |
| EasyEDA | 云端 | 免费/付费 | 与 JLCPCB 集成 |

**我们选择 KiCad 的原因：**

- ✅ **免费开源** - 无许可证成本
- ✅ **功能完整** - 专业级 PCB 设计能力
- ✅ **跨平台** - macOS / Windows / Linux
- ✅ **社区活跃** - 丰富的教程和元件库
- ✅ **版本控制友好** - 文本格式，可用 Git 管理

### 典型工作流程

```text
1. 原理图设计 (Eeschema)
   └─ 添加元件 → 连线 → 电气规则检查 (ERC)

2. 封装分配
   └─ 为每个符号指定物理封装 (如 QFN-24, 0603 电阻)

3. PCB 布局 (PCBnew)
   └─ 导入网表 → 放置元件 → 布线 → 铺铜 → DRC 检查

4. 输出制造文件
   └─ Gerber 文件 + 钻孔文件 + BOM + 贴片坐标

5. 发送给 PCB 工厂
   └─ 常用: JLCPCB, PCBWay, 嘉立创
```

### Movement Chain AI 的 KiCad 使用

| 阶段 | 设计内容 |
|------|----------|
| **MVP 原型** | ESP32-S3 + LSM6DSV16X + ADS1292 单板设计 |
| **生产版本** | 小型化设计，4 层板，集成电池管理 |

---

## 11. BLE 抖动 (BLE Jitter) {#11-ble-抖动-ble-jitter}

**定义：** BLE 抖动是指蓝牙低功耗 (Bluetooth Low Energy) 协议在数据传输时的时间不确定性，典型值为 15-30ms。

---

### 什么是抖动？

抖动 (Jitter) 是指信号传输延迟的**变化量**，而非延迟本身。

```text
理想情况（无抖动）:
ESP32 发送数据 ──────────────────> 手机接收（延迟固定 10ms）
ESP32 发送数据 ──────────────────> 手机接收（延迟固定 10ms）

实际情况（有抖动）:
ESP32 发送数据 ──────────────────> 手机接收（延迟 8ms）
ESP32 发送数据 ──────────────────> 手机接收（延迟 25ms）  ← 抖动!
ESP32 发送数据 ──────────────────> 手机接收（延迟 15ms）
ESP32 发送数据 ──────────────────> 手机接收（延迟 30ms）  ← 抖动!
```

### 抖动的来源

| 原因 | 说明 |
|------|------|
| **连接间隔** | BLE 每 7.5-4000ms 才有一次传输窗口 |
| **跳频机制** | BLE 在 37 个信道间跳转，时间不固定 |
| **重传机制** | 数据丢失时需重传，增加延迟 |
| **多设备竞争** | 多个 ESP32 共享带宽时互相影响 |

### 为什么这是问题？

对于高尔夫挥杆分析，BLE 抖动会破坏**多传感器时间同步**：

| 参数 | 数值 | 问题 |
|------|------|------|
| 下杆时间 | 200-300ms | BLE 抖动占 5-15% |
| Impact 瞬间 | ~0.5ms | 抖动是 Impact 的 30-60 倍 |
| 肌肉激活顺序 | 10-50ms 差异 | 抖动可能颠倒顺序 |

如果前臂 ESP32 和手腕 ESP32 的数据有 30ms 时间偏差，肌肉激活顺序分析就会**完全错误**。

### 解决方案：Sensor Hub 架构

```text
方案 1（有问题）: 每个传感器独立 ESP32
├── ESP32-A (前臂 EMG) ──BLE抖动──> 手机
├── ESP32-B (前臂 IMU) ──BLE抖动──> 手机
└── 两者时间无法精确对齐 ❌

方案 2（推荐）: Sensor Hub 架构
├── ESP32-A (前臂 EMG + IMU) ──> 共享同一时钟源 ✅
└── 同一 ESP32 内的数据时间戳完全同步
```

**核心思想**：同一身体部位的 IMU + EMG 放在同一个 ESP32 上，共享时钟源。

### 跨设备时间对齐

不同 ESP32 之间仍有 BLE 抖动，通过 **Impact 事件对齐**解决：

```text
ESP32-前臂:  ─────────────┤ Impact ├─────────────
ESP32-手腕:  ─────────────┤ Impact ├─────────────
                          ↑
                    以此为锚点对齐
```

Impact（击球瞬间）产生明显的加速度峰值，可作为跨设备的**时间同步锚点**。

> 详见：[关键决策 2025-12 § 时间同步](../design/decisions/architecture-decisions-2025-12-23.md#45-视频与传感器同步方案)

---

## 相关文档

- [物理学术语表](physics-glossary.md) - 力学概念（角速度、角动量等）
- [商业术语表](business-glossary.md) - 商业相关术语
- [ADR-0002 IMU 选型](../design/decisions/0002-lsm6dsv16x-imu.md) - LSM6DSV16X 选型决策
- [ADR-0005 MCU 选型](../design/decisions/0005-esp32-s3-microcontroller.md) - ESP32-S3 选型决策

---

**最后更新**: 2025年12月24日
