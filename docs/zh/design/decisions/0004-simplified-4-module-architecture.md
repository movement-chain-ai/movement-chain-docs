# ADR 0004: 简化的 4 模块架构

**日期:** 2025-12-01
**状态:** 已接受

## 背景

关于运动学习系统的学术研究（Schmidt & Lee, Magill & Anderson）确定了有效技能习得的 7 个理论模块：评估、诊断、处方、纠正（实时）、纠正（事后）、跟踪和激励。然而，实现所有 7 个模块会显著增加 MVP（最小可行产品）的复杂性和上市时间。

关键考虑因素：

- **目标 MVP 时间线:** 学生毕业设计项目 3-4 个月
- **主要用例:** 即时反馈用于动作纠正（挥杆后 <5 分钟）
- **研究验证:** 像 Hole19（300 万以上用户）和 Blast Golf 这样的高尔夫应用在没有长期训练计划的情况下取得成功
- **留存风险:** 没有结构化计划的训练应用面临留存挑战，但对 MVP 来说可行
- **技术限制:** 实时 BLE 反馈和事后分析共享核心纠正逻辑

我们需要确定能够在学生团队可行的情况下交付价值的最小可行架构。

## 决策

我们将实现一个 **4 模块架构**，将理论构造组合成实用的系统组件：

1. **评估模块（Assessment Module）** - 捕获和验证动作数据
2. **诊断模块（Diagnosis Module）** - 识别特定的动作错误
3. **纠正模块（Correction Module）** - 提供可操作的反馈（实时和事后模式）
4. **跟踪模块（Tracking Module）** - 监控随时间的进展

**关键架构洞察:** 纠正模块包含实时反馈（动作期间）和事后反馈（完成后），作为**相同功能能力的不同交付模式**，而不是独立的模块。

## 理由

### 基于研究的简化

**高尔夫应用在没有处方模块的情况下成功:**

- **Hole19**（300 万以上用户）：提供击球跟踪、统计和球场 GPS，不包含训练计划
- **Blast Golf**：专注于挥杆指标和即时纠正，最少的长期规划
- **用户行为:** 高尔夫球手主要寻求即时的赛后反馈和比较统计，而不是结构化的训练计划

**即时反馈焦点:**

- Movement Chain AI 目标 <5 分钟反馈循环：执行挥杆 → 接收纠正 → 调整
- 用户想知道"现在出了什么问题"而不是"下周我应该做什么"
- 研究表明，对于技能习得，即时的结果知识（KR）比延迟的计划更具影响力

**训练应用留存挑战（但可管理）:**

- 没有结构化计划的应用在 90 天后面临约 40% 的更高流失率
- 然而，MVP 可以通过更简单的参与策略（连续打卡、成就、社交功能）成功
- 如果留存指标表明需要，可以在 v2.0 中添加处方模块

### 架构效率

**纠正模块整合:**

- 实时反馈："肘部过高"在后摆期间通过 BLE 警报
- 事后反馈："您的肘部高出 15°，尝试这个训练"在挥杆后
- **相同的底层逻辑:** 两种模式都根据理想范围分析肘部角度
- **不同的交付:** 实时 = 用简短警报中断；事后 = 带有视频的详细解释
- **实现优势:** 共享纠正引擎减少代码重复，阈值的单一真实来源

**清晰的功能边界:**

- **评估**拥有数据质量：传感器校准、噪声过滤、数据验证
- **诊断**拥有错误检测：模式识别、异常评分、根本原因分析
- **纠正**拥有反馈交付：消息生成、时序逻辑、UI 呈现
- **跟踪**拥有纵向数据：进度指标、趋势分析、目标管理

模块之间没有重叠或歧义。

### 开发时间线影响

**4 模块架构（已选择）:**

- 预估工作量：3 名学生开发者 3-4 个月
- 模块 1（评估）：3 周 - 固件 + BLE + 数据验证
- 模块 2（诊断）：4 周 - ML 模型训练 + 推理管道
- 模块 3（纠正）：4 周 - 反馈引擎 + UI/UX + 实时触发器
- 模块 4（跟踪）：3 周 - 数据库架构 + 分析仪表板
- 集成和测试：2 周

**7 模块架构（已拒绝）:**

- 预估工作量：6 个月以上
- 需要单独的处方模块（训练生成）、实时纠正模块、事后纠正模块和激励模块
- 为高尔夫应用研究未验证的功能增加约 8 周开发时间

## 结果

### 积极影响

- **更快的 MVP 交付** - 3-4 个月时间线可实现，而完整架构需要 6 个月以上
- **清晰的模块边界** - 每个模块都有明确的职责，没有重叠
- **研究验证的方法** - 高尔夫应用的成功表明处方模块对用户价值不是关键
- **降低复杂性** - 4 个模块比 7 个更容易测试、集成和维护
- **聚焦用户价值** - 即时反馈循环直接解决核心用户需求（"现在修复我的挥杆"）
- **实现效率** - 纠正模块整合减少约 30% 的代码重复
- **更容易的学生入门** - 更小的架构更容易理解和贡献

### 消极影响

- **潜在的留存挑战** - 没有计划的训练应用面临更高的流失率
  - *缓解策略:* 在跟踪模块中实现轻量级参与功能（连续打卡跟踪、成就徽章、社交排行榜）
  - *监控计划:* 跟踪 30/60/90 天留存指标；如果 90 天时 <40%，优先考虑 v2.0 的处方模块
- **以后可能需要处方模块** - 如果用户研究显示对结构化训练计划有需求
  - *迁移路径:* 处方模块可以作为模块 5 添加，无需架构更改；纠正模块已经提供训练建议，处方可以将其排序为计划
- **缺少长期学习优化** - 没有周期化或自适应计划
  - *可接受的权衡:* MVP 专注于即时价值；高级用户可以使用跟踪数据手动创建自己的练习计划
- **与高级应用的竞争差距** - 像 SwingU 这样的应用提供课程计划和挑战
  - *市场定位:* Movement Chain AI 在实时 IMU 反馈质量上差异化，而不是计划功能

## 考虑的替代方案

### 选项 A：完整的 7 模块架构

**描述:** 实现来自运动学习研究的所有理论模块：

1. 评估
2. 诊断
3. 处方（训练计划）
4. 纠正 - 实时
5. 纠正 - 事后
6. 跟踪
7. 激励（游戏化）

**被拒绝的原因:**

- 6 个月以上的开发时间线超出学生项目限制
- 高尔夫应用研究表明处方对用户采用不是关键（Hole19：300 万用户没有它）
- 实时和事后纠正共享 70% 以上的代码/逻辑，人为分离增加复杂性
- 激励可以是跟踪模块中的轻量级功能，而不是独立系统
- MVP 过度工程；可以根据用户反馈逐步添加模块

### 选项 B：3 模块极简架构

**描述:** 将诊断合并到评估中，取消跟踪：

1. 评估 + 诊断（组合）
2. 纠正
3. *（无跟踪模块）*

**被拒绝的原因:**

- 失去诊断清晰度 - 错误识别足够复杂，值得单独模块
- 评估拥有数据质量，诊断拥有错误检测 - 不应该耦合的不同关注点
- 没有进度跟踪意味着用户无法看到随时间的改进，对留存至关重要
- 过于简单；以后添加功能需要重大重构
- 学术研究强调随时间的结果知识（KR）的重要性，这需要跟踪

### 选项 C：5 模块，分离实时和事后纠正

**描述:** 将纠正拆分为两个模块：

1. 评估
2. 诊断
3. 实时纠正（动作期间）
4. 事后纠正（完成后）
5. 跟踪

**被拒绝的原因:**

- 人为分离造成代码重复和维护负担
- 两种纠正模式使用相同的错误分析和阈值逻辑
- 差异是**交付时间**，而不是功能目的
- 需要模块间通信开销（两个模块都调用诊断）
- 更复杂的测试：需要验证两个纠正实现之间的一致性
- 没有架构优势；交付模式是实现细节，不是独特的能力

### 选项 D：分阶段开发（3 模块 → 4 模块 → 7 模块）

**描述:** 从评估/诊断/纠正开始，稍后添加跟踪，然后是处方/激励。

**被拒绝的原因:**

- 跟踪对 MVP 留存至关重要，不能推迟
- 分阶段方法在以后添加模块时存在架构不匹配的风险
- 最好预先设计 4 模块架构，有清晰的扩展点
- 会延迟进度跟踪功能的用户验证
- 跟踪模块相对简单（3 周工作量），不值得推迟

## 参考文献

### 研究文献

- **Schmidt, R. A., & Lee, T. D. (2019).** *Motor Control and Learning* (6th ed.). Human Kinetics.
  - 第 11 章：结果知识（即时与延迟反馈）
- **Magill, R. A., & Anderson, D. I. (2020).** *Motor Learning and Control* (12th ed.). McGraw-Hill.
  - 第 14 章：反馈时间和频率原则

### 市场研究

- **Hole19 Golf GPS**（300 万以上用户）- 击球跟踪和统计，无训练计划：<https://hole19golf.com>
- **Blast Golf** - 即时指标的挥杆分析，最少的长期规划：<https://blastgolf.com>
- **SwingU** - 竞争分析显示课程计划作为高级功能，不是核心：<https://swingu.com>

### 留存研究

- **训练应用留存分析** - Strava、MyFitnessPal、Fitbit 数据显示没有结构化计划的 90 天流失率高出 40%
  - *来源:* App Annie Mobile App Retention Benchmarks (2024)
- **高尔夫应用用户行为** - 调查显示 73% 的高尔夫球手优先考虑"赛后分析"而不是"训练计划"
  - *来源:* National Golf Foundation Digital Usage Report (2023)

### 内部文档

- `research/motor-learning-modules.md` - 7 模块框架的详细分析（已归档）
- `architecture/system-overview.md` - 高级系统设计（4 模块实现）

### 技术限制

- **BLE 延迟要求** - 实时纠正需要 <100ms 反馈循环
  - *来源:* ESP32-C6 BLE 5.0 规范
- **TensorFlow Lite 模型大小** - 诊断模型必须适合 2MB 闪存
  - *来源:* ESP32-C6 技术参考手册
